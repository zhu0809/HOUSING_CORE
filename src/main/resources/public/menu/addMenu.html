<!DOCTYPE html>
<html>
<head>
    <title>菜单管理</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jstree/3.3.3/themes/default/style.min.css"/>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jstree/3.3.3/jstree.min.js"></script>
    <!--<script type="text/javascript" src="../scripts/jquery/jquery-1.7.1.js"></script>-->
    <link href="../style/authority/basic_layout.css" rel="stylesheet" type="text/css">
    <link href="../style/authority/common_style.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="../scripts/authority/commonAll.js"></script>
    <script src="../scripts/My97DatePicker/WdatePicker.js" type="text/javascript" defer="defer"></script>
    <script type="text/javascript" src="../scripts/artDialog/artDialog.js?skin=default"></script>
    <script type="text/javascript" src="/scripts/fancybox/jquery.fancybox-1.3.4.js"></script>
    <script type="text/javascript" src="/scripts/fancybox/jquery.fancybox-1.3.4.pack.js"></script>
    <link rel="stylesheet" type="text/css" href="/style/authority/jquery.fancybox-1.3.4.css" media="screen"></link>

    <script type="text/javascript">
        $(document).ready(function () {
            function loadMenu(resourceType, treeObj) {
                $.ajax({
                    type: "get",
                    url: "/menu/getAllMenu",
                    dataType: "json",
                    success: function (datas) {
                        var data = datas.menuList;

                        console.log(data);

                        if (data != null) {
                            // 将返回的数据赋给zTree
                            $.fn.zTree.init($("#" + treeObj), setting, data);
                            //alert(treeObj);
                            zTree = $.fn.zTree.getZTreeObj(treeObj);
                            if (zTree) {
                                // 默认展开所有节点
                                zTree.expandAll(false);
                            }
                        }
                    }
                });
                /**/// 如果返回数据不为空，加载"业务模块"目录
                // if(data != null){
                //     将返回的数据赋给zTree
                // $.fn.zTree.init($("#"+treeObj), setting, data);
                // alert(treeObj);
                // zTree = $.fn.zTree.getZTreeObj(treeObj);
                // if( zTree ){
                //     默认展开所有节点
                // zTree.expandAll(false);
                // }
                // }
            }

            /*
             * 提交
             */
            $("#submitbutton").click(function () {
                if (validateForm()) {
                    checkFyFhSubmit();
                }
            });

            /*
             * 取消
             */
            $("#cancelbutton").click(function () {
                /**  关闭弹出iframe  **/
                window.parent.$.fancybox.close();
            });

            var result = 'null';
            if (result == 'success') {
                /**  关闭弹出iframe  **/
                window.parent.$.fancybox.close();
            }
        });

    </script>
</head>
<body>

<div id="container"></div>

<script type="text/javascript">

    $(function () {
        $.getJSON("/menu/menuTree", function (data) {
            init(data.data);
        })

    });

    function create(obj) {
        $("#addBtn").fancybox({
            'href'  : '/menu/addNode.html',
            'width' : 733,
            'height' : 530,
            'type' : 'iframe',
            'hideOnOverlayClick' : false,
            'showCloseButton' : false,
            'onClosed' : function() {
                window.location.href = 'house_list.html';
            }
        });
    }

    function init(data) {
        $('#container').jstree({
            'core': {
                'data': data,
                "check_callback": true,

            },
            "themes": {
                "theme": "classic",
                "dots": true,
                "icons": true
            },

            "contextmenu": {
                select_node: false,
                show_at_node: true,
                items: {
                    "新建设备": {
                        "label": "新建菜单",
                        "icon": "glyphicon glyphicon-plus",
                        "action": function (data) {
                            console.log(data);
                            var inst = $.jstree.reference(data.reference),
                                obj = inst.get_node(data.reference);
                            console.log(obj);

                            create(obj);
                        }
                    },
                    "修改设备": {
                        "separator_before": false,
                        "separator_after": false,
                        "_disabled": false, //(this.check("rename_node", data.reference, this.get_parent(data.reference), "")),
                        "label": "修改设备",
                        "shortcut_label": 'F2',
                        "icon": "glyphicon glyphicon-leaf",
                        "action": function (data) {
                            var inst = $.jstree.reference(data.reference),
                                obj = inst.get_node(data.reference);
                            inst.edit(obj);
                        }
                    },
                    "删除设备": {
                        "separator_before": false,
                        "icon": false,
                        "separator_after": false,
                        "_disabled": false, //(this.check("delete_node", data.reference, this.get_parent(data.reference), "")),
                        "label": "删除设备",
                        "icon": "glyphicon glyphicon-remove",
                        "action": function (data) {
                            var inst = $.jstree.reference(data.reference),
                                obj = inst.get_node(data.reference);
                            if (inst.is_selected(obj)) {
                                inst.delete_node(inst.get_selected());
                            }
                            else {
                                inst.delete_node(obj);
                            }
                        }
                    }
                }
            },

            "plugins": ["contextmenu", "themes"]
        });
    }

</script>
</body>
</html>